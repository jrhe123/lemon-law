<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>WebSocket Agent Streaming Test</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 2em; }
    #output { white-space: pre-wrap; border: 1px solid #ccc; padding: 1em; min-height: 100px; }
    #status { color: green; }
  </style>
</head>
<body>
  <h2>WebSocket Agent Streaming Test</h2>
  <div>
    <label>Input: <input id="input" value="recommend a game for me" style="width: 300px;"></label>
    <label>User ID: <input id="userId" value="u1" style="width: 100px;"></label>
    <button id="send">Send</button>
  </div>
  <div id="status"></div>
  <h3>Agent Output:</h3>
  <div id="output"></div>
  <script>
    let ws;
    const output = document.getElementById('output');
    const status = document.getElementById('status');
    document.getElementById('send').onclick = function() {
      output.textContent = '';
      status.textContent = 'Connecting...';
      ws = new WebSocket('ws://' + location.hostname + ':3002');
      ws.onopen = () => {
        status.textContent = 'Connected.';
        ws.send(JSON.stringify({
          input: document.getElementById('input').value,
          userId: document.getElementById('userId').value
        }));
      };
      ws.onmessage = (event) => {
        const msg = JSON.parse(event.data);
        if (msg.type === 'token') {
          output.textContent += msg.data;
        } else if (msg.type === 'end') {
          status.textContent = 'Done.';
        } else if (msg.type === 'error') {
          status.textContent = 'Error: ' + msg.data;
        }
      };
      ws.onerror = (e) => {
        status.textContent = 'WebSocket error.';
      };
      ws.onclose = () => {
        status.textContent += ' (Connection closed)';
      };
    };
  </script>
</body>
</html> 